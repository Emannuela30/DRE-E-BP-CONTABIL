import pandas as pd
import streamlit as st
import plotly.express as px
import datetime as dt
import plotly.graph_objects as go
import numpy as np
from streamlit_extras.metric_cards import style_metric_cards
st.set_option('deprecation.showPyplotGlobalUse', False)
import os


st.set_page_config(layout='wide')
st.markdown(
    """
    <style>
    [data-testid="stSidebar"] {
        background-color: #103F7A;
    }
    [data-testid="stSidebar"] * {
        color: black;
    }

    </style>
    """,
    unsafe_allow_html=True
)

st.sidebar.markdown('Desenvolvido por Emanuela Pereira')
df = pd.read_csv('hotel.csv')
df["Data"] = pd.to_datetime(df["Data"])
df.info()
df=df.sort_values("Data")
df.dropna()



df['Month']=df['Data'].apply(lambda x: str(x.year) + '-' + str(x.month))
month = st.sidebar.selectbox("Selecione o mÃªs", df['Month'].unique())

df_filtered = df[df["Month"] == month]

st.markdown('# DemonstraÃ§Ã£o do Resultado do ExercÃ­cio')
st.divider()

col1, col2 = st.columns(2)
col21, col22 = st.columns(2)
col4, col5 = st.columns(2)

receita=df_filtered ['Receita']
receita_liquida = df_filtered['Receita Liquida']
lucro_bruto = df_filtered['Lucro Bruto']
lucro_liquido = df_filtered['Lucro Liquido']
ativo_circulante = df['Ativo Circulante'].sum()
passivo_circulante = df['Passivo Circulante'].sum()
capital_circulante_liquido = (ativo_circulante/passivo_circulante)*100


       
margem_bruta = float(lucro_bruto/receita)*100
with col1:
        st.info('Margem bruta',icon="ðŸ’°")
        st.metric(label="Margem bruta",value=f"{margem_bruta:,.2f}%")
        

margem_liquida = float(lucro_liquido/receita)*100
with col2:
        st.info('Margem liquida',icon="ðŸ’°")
        st.metric(label="Margem liquida",value=f"{margem_liquida:,.2f}%")

lucratividade = float(lucro_liquido/receita)*100
with col21:
        st.info('Lucratividade',icon="ðŸ’°")
        st.metric(label="Lucratividade",value=f"R${lucratividade:,.2f}")

endividamento_geral = float(passivo_circulante/ativo_circulante)*100
with col22:
        st.info('Endividamento Geral',icon="ðŸ’°")
        st.metric(label="Endividamento Geral",value=f"{endividamento_geral:,.2f}%")



st.divider()
fig1 = px.bar(df, x='Receita', y='Month',labels={'x': 'Receita', 'y': 'Month'},title='Receita Mensal')
col4.plotly_chart(fig1,use_container_width=True)



fig2 = px.bar(df, y='Month', x='Gastos Explicitos',labels={'y': 'Month', 'x': 'Gastos Explicitos'},title='Gasto Mensal')
col5.plotly_chart(fig2,use_container_width=True)




                  

col6, col7= st.columns(2)



fig09 = px.pie(df, values='Lucro Bruto', names='Month', title='Lucro Bruto')
col6.plotly_chart(fig09, use_container_width=True)


fig_lucro = px.pie(df, values='Lucro Liquido', names='Month', title='Lucro Liquido')
col7.plotly_chart(fig_lucro, use_container_width=True)






